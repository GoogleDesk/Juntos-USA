<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ApoyoYA — Legal Resources Nearby</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { theme: { extend: {} }, corePlugins: { preflight: true } };
    </script>
    <style>
      html, body, #app { height: 100%; }
      body { background: #fff; color: #0f172a; }
    </style>
  </head>
  <body>
    <div id="app" class="min-h-screen flex flex-col">
      <!-- Header (solid) -->
      <header class="border-b border-slate-200 bg-white sticky top-0 z-40 shadow-md">
        <div class="mx-auto max-w-6xl px-4 h-14 flex items-center gap-6">
          <a href="/" class="flex items-center gap-2">
            <div class="h-8 w-8 rounded-xl bg-emerald-700"></div>
            <span class="font-semibold text-slate-900">Apoyo a Inmigrantes</span>
          </a>
          <nav class="hidden sm:flex items-center gap-4 text-sm font-medium text-slate-800">
            <a href="/" class="hover:text-emerald-700">Home</a>
            <a href="/finder.html" class="hover:text-emerald-700">Legal Resources Nearby</a>
          </nav>
          <button id="lang-toggle" class="ml-auto inline-flex items-center gap-2 rounded-lg bg-slate-100 px-3 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-200 border border-slate-300 shadow-sm">
            Switch to Spanish
          </button>
        </div>
      </header>

      <!-- Content -->
      <main class="flex-1">
        <section class="py-8">
          <div class="mx-auto max-w-6xl px-4">
            <h1 id="title" class="text-2xl sm:text-3xl font-semibold text-slate-900">Legal Resources Nearby</h1>
            <p id="subtitle" class="mt-1 text-slate-600 max-w-2xl">Find trustworthy legal help by area and category.</p>

            <div class="mt-5 rounded-2xl border border-slate-200 bg-white p-4 sm:p-5">
              <div class="flex flex-col sm:flex-row gap-3 sm:items-end">
                <div class="flex-1">
                  <label id="lbl-zip" class="text-sm text-slate-700">ZIP code</label>
                  <input id="zip" inputmode="numeric" placeholder="30303" class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-400" />
                </div>
                <div class="flex-1">
                  <label id="lbl-cat" class="text-sm text-slate-700">Category</label>
                  <div id="pills" class="mt-1 flex flex-wrap gap-2"></div>
                </div>
                <div class="flex items-center gap-2">
                  <input id="pb" type="checkbox" class="h-4 w-4 rounded border-slate-300" />
                  <label id="lbl-pb" for="pb" class="text-sm text-slate-700">Pro bono only</label>
                </div>
              </div>

              <div class="mt-5 grid gap-4 lg:grid-cols-3">
                <div id="results" class="lg:col-span-2 space-y-3"></div>
                <div class="rounded-xl border border-slate-200 bg-slate-50 p-3">
                  <div id="mapph" class="aspect-[4/3] w-full rounded-lg bg-[linear-gradient(45deg,#e2e8f0,#cbd5e1)] flex items-center justify-center text-slate-600 text-sm">Map placeholder</div>
                  <p id="mapnote" class="mt-2 text-xs text-slate-600">Note: this map is a placeholder.</p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer class="border-t border-slate-200 bg-white shadow-inner">
        <div class="mx-auto max-w-6xl px-4 py-6 text-sm text-slate-600 flex justify-between items-center">
          <p>© <span id="year"></span> Apoyo a Inmigrantes</p>
          <a href="/" class="font-semibold text-slate-800 hover:text-emerald-700" id="home-link">Home</a>
        </div>
      </footer>
    </div>

    <script>
      const COPY = {
        en: {
          title: "Legal Resources Nearby",
          subtitle: "Find trustworthy legal help by area and category.",
          home: "Home",
          toggle: "Switch to Spanish",
          zipcode: "ZIP code",
          category: "Category",
          proBonoOnly: "Pro bono only",
          mapNote: "Note: this map is a placeholder.",
          mapPH: "Map placeholder",
          noResults: "No results. Try another category or expand the area.",
          catLabels: { asilo: "Asylum", defensa: "Removal defense", trabajo: "Work", naturalizacion: "Naturalization", familia: "Family", victimas: "Victims" }
        },
        es: {
          title: "Recursos Legales Cercanos",
          subtitle: "Encuentre ayuda legal confiable por zona y categoría.",
          home: "Inicio",
          toggle: "Cambiar a inglés",
          zipcode: "Código postal",
          category: "Categoría",
          proBonoOnly: "Solo pro bono",
          mapNote: "Nota: este mapa es un ejemplo.",
          mapPH: "Mapa (marcador de posición)",
          noResults: "No hay resultados. Pruebe otra categoría o amplíe el área.",
          catLabels: { asilo: "Asilo", defensa: "Defensa contra deportación", trabajo: "Trabajo", naturalizacion: "Naturalización", familia: "Familia", victimas: "Víctimas" }
        }
      };
      const CATS = ["asilo","defensa","trabajo","naturalizacion","familia","victimas"];
      let lang = "en";

      const $ = (id) => document.getElementById(id);
      const resultsEl = $("results");
      const pillsEl = $("pills");
      const zipEl = $("zip");
      const pbEl = $("pb");

      const state = { cat: null, zip: "", pb: false, data: [] };

      function renderStrings() {
        const t = COPY[lang];
        $("title").textContent = t.title;
        document.title = "ApoyoYA — " + t.title;
        $("subtitle").textContent = t.subtitle;
        $("home-link").textContent = t.home;
        $("lang-toggle").textContent = t.toggle;
        $("lbl-zip").textContent = t.zipcode;
        $("lbl-cat").textContent = t.category;
        $("lbl-pb").textContent = t.proBonoOnly;
        $("mapph").textContent = t.mapPH;
        $("mapnote").textContent = t.mapNote;
      }

      function renderPills() {
        const t = COPY[lang];
        pillsEl.innerHTML = "";
        CATS.forEach((id) => {
          const btn = document.createElement("button");
          btn.className = "rounded-full px-3 py-1 text-sm border transition " + (state.cat === id ? "bg-emerald-600 text-white border-emerald-600" : "bg-white text-slate-700 border-slate-300 hover:border-slate-400");
          btn.textContent = t.catLabels[id];
          btn.onclick = () => { state.cat = (state.cat === id ? null : id); renderPills(); renderResults(); };
          pillsEl.appendChild(btn);
        });
      }

      function matches(r) {
        const byZip = state.zip ? String(r.zip || "").startsWith(state.zip) : true;
        const byCat = state.cat ? (r.categories || []).includes(state.cat) : true;
        const byPb = state.pb ? !!r.pro_bono : true;
        return byZip && byCat && byPb;
      }

      function card(resource) {
        const t = COPY[lang];
        const cats = (resource.categories || []).map(c => t.catLabels[c] || c).join(", ");
        const div = document.createElement("div");
        div.className = "rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden";
        div.innerHTML = `
          <div class="p-4 sm:p-5">
            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2">
              <div>
                <h4 class="font-semibold text-slate-900">${resource.name}</h4>
                <p class="text-sm text-slate-600">${resource.address || ""}</p>
                <div class="mt-2 text-xs text-slate-600">${cats}${resource.pro_bono ? " • Pro bono" : ""}</div>
              </div>
              <div class="flex gap-2">
                ${resource.phone ? `<a class="inline-flex items-center justify-center rounded-xl bg-emerald-700 px-4 py-2 text-white font-medium hover:bg-emerald-800" href="tel:${resource.phone}">${lang==="es"?"Llamar":"Call"}</a>` : ""}
                ${resource.website ? `<a class="inline-flex items-center justify-center rounded-xl border border-slate-300 px-4 py-2 text-slate-800 font-medium hover:bg-slate-50" href="${resource.website}" target="_blank" rel="noopener">Website</a>` : ""}
              </div>
            </div>
          </div>`;
        return div;
      }

      function renderResults() {
        const t = COPY[lang];
        const filtered = state.data.filter(matches);
        resultsEl.innerHTML = "";
        if (filtered.length === 0) {
          const none = document.createElement("div");
          none.className = "rounded-2xl border border-slate-200 bg-white p-4 text-sm text-slate-600";
          none.textContent = t.noResults;
          resultsEl.appendChild(none);
          return;
        }
        filtered.forEach(r => resultsEl.appendChild(card(r)));
      }

      async function loadData() {
        try {
          const res = await fetch("/data/resources.json", { cache: "no-store" });
          const json = await res.json();
          state.data = Array.isArray(json) ? json : [];
          renderResults();
        } catch (e) {
          state.data = [];
          renderResults();
        }
      }

      // Events
      zipEl.addEventListener("input", () => { state.zip = zipEl.value.trim(); renderResults(); });
      pbEl.addEventListener("change", () => { state.pb = pbEl.checked; renderResults(); });
      document.getElementById("lang-toggle").addEventListener("click", () => {
        lang = (lang === "en" ? "es" : "en");
        renderStrings();
        renderPills();
        renderResults();
      });

      // Init
      document.getElementById("year").textContent = new Date().getFullYear();
      renderStrings();
      renderPills();
      loadData();
    </script>
  </body>
</html>
